<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entreprises Contactées</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-dark text-white">
  <div class="container">
    <h2>Entreprises déjà contactées</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Nom de l'entreprise</th>
          <th>Secteur</th>
          <th>Date de candidature</th>
          <th>Format de candidature</th>
          <th>Nom du contact</th>
          <th>Poste visé</th>
          <th>Adresse</th>
          <th>Numéro de téléphone</th>
          <th>Email du contact</th>
          <th>Prise de note complémentaire</th>
          <th>Lettre de motivation envoyée</th>
          <th>CV envoyé</th>
          <th>Fichiers complémentaires</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="companiesTableBody">
        <!-- Companies will be added here by JavaScript -->
      </tbody>
    </table>
    <a href="main.html" class="btn btn-secondary">Retour</a>
  </div>
  <script src="meca.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Récupérer les données depuis le stockage local
      var companies = JSON.parse(localStorage.getItem("companies")) || [];

      // Sélectionner le corps du tableau
      var tbody = document.getElementById("companiesTableBody");

      // Boucler à travers les données des entreprises et les ajouter au tableau
      companies.forEach(function(company) {
        var row = tbody.insertRow();
        var nameCell = row.insertCell(0);
        var sectorCell = row.insertCell(1);
        var dateCell = row.insertCell(2);
        var formatCell = row.insertCell(3);
        var contactNameCell = row.insertCell(4);
        var targetPositionCell = row.insertCell(5);
        var addressCell = row.insertCell(6);
        var phoneNumberCell = row.insertCell(7);
        var contactEmailCell = row.insertCell(8);
        var additionalNotesCell = row.insertCell(9);
        var motivationLetterCell = row.insertCell(10);
        var cvCell = row.insertCell(11);
        var additionalFilesCell = row.insertCell(12);
        // Ajouter les données dans les cellules
        nameCell.innerHTML = company.companyName;
        sectorCell.innerHTML = company.sector;
        dateCell.innerHTML = company.applicationDate;
        formatCell.innerHTML = company.applicationFormat.join(", ");
        contactNameCell.innerHTML = company.contactName;
        targetPositionCell.innerHTML = company.targetPosition;
        addressCell.innerHTML = company.address;
        phoneNumberCell.innerHTML = company.phoneNumber;
        contactEmailCell.innerHTML = company.contactEmail;
        additionalNotesCell.innerHTML = company.additionalNotes;
        motivationLetterCell.innerHTML = '<a href="' + company.motivationLetter + '">Télécharger</a>';
        cvCell.innerHTML = '<a href="' + company.cv + '">Télécharger</a>';
        additionalFilesCell.innerHTML = renderAdditionalFiles(company.additionalFiles);
        // Ajouter d'autres colonnes si nécessaire
        var actionsCell = row.insertCell(13);
        actionsCell.innerHTML = '<button class="btn btn-danger btn-sm" onclick="deleteCompany(' + companies.indexOf(company) + ')">Supprimer</button>';
      });
    });

    // Fonction pour supprimer une entreprise
    function deleteCompany(index) {
      var companies = JSON.parse(localStorage.getItem("companies")) || [];
      companies.splice(index, 1);
      localStorage.setItem("companies", JSON.stringify(companies));
      location.reload(); // Recharger la page pour refléter les changements
    }

    // Fonction pour afficher les fichiers supplémentaires
    function renderAdditionalFiles(files) {
      var result = '';
      if (files && files.length > 0) {
        files.forEach(function(file) {
          result += '<a href="' + file + '">Télécharger</a><br>';
        });
      }
      return result;
    }
  </script>
</body>
</html>
